// Datastar Core v1.0.0-RC.1
var Z=/ðŸ–•JS_DSðŸš€/.source,C=Z.slice(0,5),I=Z.slice(4),x="datastar";function w(e){return e instanceof HTMLElement||e instanceof SVGElement}var S=e=>e!==null&&typeof e=="object"&&(Object.getPrototypeOf(e)===Object.prototype||Object.getPrototypeOf(e)===null);function X(e){for(let t in e)if(Object.hasOwn(e,t))return!1;return!0}var K=(e,t)=>{for(let n in t){let i=n.split("."),s=i.pop(),a=i.reduce((o,r)=>o[r]??={},e);a[s]=t[n]}return e};var Y=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").replace(/([a-z])([0-9]+)/gi,"$1-$2").replace(/([0-9]+)([a-z])/gi,"$1-$2").toLowerCase(),A=e=>Y(e).replace(/-./g,t=>t[1].toUpperCase()),$=e=>Y(e).replace(/-/g,"_");var Oe="https://data-star.dev/errors";function ee(e,t,n={}){let i=new Error;i.name=`${x} ${e} error`;let s=$(t),a=new URLSearchParams({metadata:JSON.stringify(n)}).toString(),o=JSON.stringify(n,null,2);return i.message=`${t}
More info: ${Oe}/${e}/${s}?${a}
Context: ${o}`,i}function te(e,t,n={}){let i={plugin:{name:t.plugin.name,type:t.plugin.type}};return ee("init",e,Object.assign(i,n))}function ne(e,t,n={}){let i={plugin:{name:e.plugin.name,type:e.plugin.type},element:{id:e.el.id,tag:e.el.tagName},expression:{rawKey:e.rawKey,key:e.key,value:e.value,fnContent:e.fnContent}};return ee("runtime",t,Object.assign(i,n))}var ie=`${x}-signal-patch`;var D={},H=[],j=0,L=0,W=0,m,P=()=>{j++},M=()=>{--j||(le(),p())},T=e=>Me.bind(0,{previousValue:e,t:e,e:1}),re=Symbol("computed"),ae=e=>{let t=Pe.bind(0,{e:17,getter:e});return t[re]=1,t},ce=e=>{let t={d:e,e:2};m&&B(t,m);let n=v(t);P();try{t.d()}finally{M(),v(n)}return ge.bind(0,t)},J=e=>{let t=v(void 0);try{return e()}finally{v(t)}},le=()=>{for(;L<W;){let e=H[L];H[L++]=void 0,de(e,e.e&=-65)}L=0,W=0},se=e=>"getter"in e?ue(e):fe(e,e.t),v=e=>{let t=m;return m=e,t},ue=e=>{let t=v(e);pe(e);try{let n=e.t;return n!==(e.t=e.getter(n))}finally{v(t),ye(e)}},fe=(e,t)=>(e.e=1,e.previousValue!==(e.previousValue=t)),Q=e=>{let t=e.e;if(!(t&64)){e.e=t|64;let n=e.o;n?Q(n.r):H[W++]=e}},de=(e,t)=>{if(t&16||t&32&&me(e.s,e)){let i=v(e);pe(e),P();try{e.d()}finally{M(),v(i),ye(e)}return}t&32&&(e.e=t&-33);let n=e.s;for(;n;){let i=n.c,s=i.e;s&64&&de(i,i.e=s&-65),n=n.n}},Pe=e=>{let t=e.e;if(t&16||t&32&&me(e.s,e)){if(ue(e)){let n=e.o;n&&V(n)}}else t&32&&(e.e=t&-33);return m&&B(e,m),e.t},Me=(e,...t)=>{if(t.length){let i=t[0];if(e.t!==(e.t=i)){e.e=17;let s=e.o;return s&&(Ce(s),j||le()),!0}return!1}let n=e.t;if(e.e&16&&fe(e,n)){let i=e.o;i&&V(i)}return m&&B(e,m),n},ge=e=>{let t=e.s;for(;t;)t=N(t,e);let n=e.o;n&&N(n),e.e=0},B=(e,t)=>{let n=t.a;if(n&&n.c===e)return;let i,s=t.e&4;if(s&&(i=n?n.n:t.s,i&&i.c===e)){t.a=i;return}let a=e.g;if(a&&a.r===t&&(!s||ve(a,t)))return;let o=t.a=e.g={c:e,r:t,l:n,n:i,u:a};i&&(i.l=o),n?n.n=o:t.s=o,a?a.i=o:e.o=o},N=(e,t=e.r)=>{let n=e.c,i=e.l,s=e.n,a=e.i,o=e.u;if(s?s.l=i:t.a=i,i?i.n=s:t.s=s,a?a.u=o:n.g=o,o)o.i=a;else if(!(n.o=a))if("getter"in n){let r=n.s;if(r){n.e=17;do r=N(r,n);while(r)}}else"previousValue"in n||ge(n);return s},Ce=e=>{let t=e.i,n;e:for(;;){let i=e.r,s=i.e;if(s&3&&(s&60?s&12?s&4?!(s&48)&&ve(e,i)?(i.e=s|40,s&=1):s=0:i.e=s&-9|32:s=0:i.e=s|32,s&2&&Q(i),s&1)){let a=i.o;if(a){e=a,a.i&&(n={t,f:n},t=e.i);continue}}if(e=t){t=e.i;continue}for(;n;)if(e=n.t,n=n.f,e){t=e.i;continue e}break}},pe=e=>{e.a=void 0,e.e=e.e&-57|4},ye=e=>{let t=e.a,n=t?t.n:e.s;for(;n;)n=N(n,e);e.e&=-5},me=(e,t)=>{let n,i=0;e:for(;;){let s=e.c,a=s.e,o=!1;if(t.e&16)o=!0;else if((a&17)===17){if(se(s)){let r=s.o;r.i&&V(r),o=!0}}else if((a&33)===33){(e.i||e.u)&&(n={t:e,f:n}),e=s.s,t=s,++i;continue}if(!o&&e.n){e=e.n;continue}for(;i;){--i;let r=t.o,d=r.i;if(d?(e=n.t,n=n.f):e=r,o){if(se(t)){d&&V(r),t=e.r;continue}}else t.e&=-33;if(t=e.r,e.n){e=e.n;continue e}o=!1}return o}},V=e=>{do{let t=e.r,n=e.i,i=t.e;(i&48)===32&&(t.e=i|16,i&2&&Q(t)),e=n}while(e)},ve=(e,t)=>{let n=t.a;if(n){let i=t.s;do{if(i===e)return!0;if(i===n)break;i=i.n}while(i)}return!1},U=e=>e.split(".").reduce((t,n)=>t[n],R),Re=e=>J(()=>e.split(".").reduce((t,n)=>t&&Object.hasOwn(t,n)?t[n]:void 0,R)!==void 0),oe=Symbol("delete"),k=(e,t="")=>{let n=Array.isArray(e);if(n||S(e)){let i=n?[]:{};for(let a in e)i[a]=T(k(e[a],`${t+a}.`));let s=T(0);return new Proxy(i,{get:(a,o)=>{if(!(o==="toJSON"&&!Object.hasOwn(i,o)))return n&&o in Array.prototype?(s(),i[o]):((!Object.hasOwn(i,o)||i[o]()==null)&&(i[o]=T(""),p({[t+o]:""}),s(s()+1)),i[o]())},set:(a,o,r)=>(r===oe?Object.hasOwn(i,o)&&(delete i[o],p({[t+o]:oe}),s(s()+1)):n&&o==="length"?(i[o]=r,p({[t.slice(0,-1)]:i}),s(s()+1)):Object.hasOwn(i,o)?r==null?i[o](null)&&p({[t+o]:null}):i[o](k(r,`${t+o}.`))&&p({[t+o]:r}):r!=null&&(Object.hasOwn(r,re)?(i[o]=r,p({[t+o]:""})):(i[o]=T(k(r,`${t+o}.`)),p({[t+o]:r})),s(s()+1)),!0),deleteProperty:(a,o)=>(Object.hasOwn(i,o)&&i[o](null)&&p({[t+o]:null}),!0),ownKeys:()=>(s(),Reflect.ownKeys(i)),has(a,o){return s(),o in i}})}return e},p=e=>{if(e&&K(D,e),!j&&!X(D)){let t=D;D={},document.dispatchEvent(new CustomEvent(ie,{detail:t}))}},he=(e,{ifMissing:t}={})=>{P();for(let n in e)e[n]==null?t||delete R[n]:xe(e[n],n,R,"",t);M()},xe=(e,t,n,i,s)=>{if(S(e)){Object.hasOwn(n,t)&&(S(n[t])||Array.isArray(n[t]))||(n[t]={});for(let a in e)e[a]==null?s||delete n[t][a]:xe(e[a],a,n[t],`${i+t}.`,s)}else s&&Object.hasOwn(n,t)||(n[t]=e)};function Te({include:e=/.*/,exclude:t=/(?!)/}={},n=R){let i={},s=[[n,""]];for(;s.length;){let[a,o]=s.pop();for(let r in a)S(a[r])?s.push([a[r],`${o+r}.`]):e.test(o+r)&&!t.test(o+r)&&(i[o+r]=U(o+r))}return K({},i)}var R=k({}),F={},_=[],Ee=[],b=new Map,q=null,O="";function Se(e){O=e}function Ae(e){return O?`data-${O}-${e}`:`data-${e}`}function be(...e){for(let t of e){let n={plugin:t,actions:F,root:R,filtered:Te,signal:T,computed:ae,effect:ce,mergePatch:he,peek:J,getPath:U,hasPath:Re,startBatch:P,endBatch:M};if(t.type==="action")F[t.name]=t;else if(t.type==="attribute")_.push(t),t.onGlobalInit?.(n);else if(t.type==="watcher")t.onGlobalInit?.(n);else throw te("InvalidPluginType",n)}_.sort((t,n)=>{let i=n.name.length-t.name.length;return i!==0?i:t.name.localeCompare(n.name)}),Ee=_.map(t=>RegExp(`^${t.name}([A-Z]|_|$)`))}function G(e){let t=`[${Ae("ignore")}]`;for(let n of e)if(!n.closest(t))for(let i in n.dataset)Fe(n,i,n.dataset[i])}function z(e=document.body){queueMicrotask(()=>{G([e]),G(e.querySelectorAll("*")),q||(q=new MutationObserver(we),q.observe(e,{subtree:!0,childList:!0,attributes:!0}))})}function Fe(e,t,n){let i=A(O?t.slice(O.length):t),s=_.find((a,o)=>Ee[o].test(i));if(s){let[a,...o]=i.slice(s.name.length).split(/__+/),r=!!a;r&&(a=A(a));let d=!!n,l={plugin:s,actions:F,root:R,filtered:Te,signal:T,computed:ae,effect:ce,mergePatch:he,peek:J,getPath:U,hasPath:Re,startBatch:P,endBatch:M,el:e,rawKey:i,key:a,value:n,mods:new Map,runtimeErr:0,rx:0};l.runtimeErr=ne.bind(0,l),(s.shouldEvaluate===void 0||s.shouldEvaluate===!0)&&(l.rx=$e(l));let h=s.keyReq||"allowed";if(r){if(h==="denied")throw l.runtimeErr(`${s.name}KeyNotAllowed`)}else if(h==="must")throw l.runtimeErr(`${s.name}KeyRequired`);let u=s.valReq||"allowed";if(d){if(u==="denied")throw l.runtimeErr(`${s.name}ValueNotAllowed`)}else if(u==="must")throw l.runtimeErr(`${s.name}ValueRequired`);if(h==="exclusive"||u==="exclusive"){if(r&&d)throw l.runtimeErr(`${s.name}KeyAndValueProvided`);if(!r&&!d)throw l.runtimeErr(`${s.name}KeyOrValueRequired`)}for(let f of o){let[g,...y]=f.split(".");l.mods.set(A(g),new Set(y.map(E=>E.toLowerCase())))}let c=s.onLoad(l);if(c){let f=b.get(e);f?f.get(i)?.():(f=new Map,b.set(e,f)),f.set(i,c)}}}function we(e){let t=`[${Ae("ignore")}]`;for(let{target:n,type:i,attributeName:s,addedNodes:a,removedNodes:o}of e)if(i==="childList"){for(let r of o)if(w(r)){let d=b.get(r);if(b.delete(r)){for(let l of d.values())l();d.clear()}}for(let r of a)w(r)&&(G([r]),G(r.querySelectorAll("*")))}else if(i==="attributes"&&w(n)&&!n.closest(t)){let r=A(s.slice(5)),d=n.getAttribute(s);if(d===null){let l=b.get(n);l&&(l.get(r)?.(),l.delete(r))}else Fe(n,r,d)}}function $e(e){let t="",n=e.plugin||void 0;if(n?.returnsValue){let u=/(\/(\\\/|[^/])*\/|"(\\"|[^"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|\(\s*((function)\s*\(\s*\)|(\(\s*\))\s*=>)\s*(?:\{[\s\S]*?\}|[^;){]*)\s*\)\s*\(\s*\)|[^;])+/gm,c=e.value.trim().match(u);if(c){let f=c.length-1,g=c[f].trim();g.startsWith("return")||(c[f]=`return (${g});`),t=c.join(`;
`)}}else t=e.value.trim();t=t.replace(/\$([\w.-]+(?:\.[\w.-]+)*?)(?=\s|$|[^\w.-])/g,(u,c)=>c.endsWith("-")&&u.length<t.length&&t[t.indexOf(u)+u.length]==="$"?(c=c.slice(0,-1),`${c.split(".").reduce((y,E)=>`${y}['${E}']`,"$")}-`):c.split(".").reduce((g,y)=>`${g}['${y}']`,"$"));let i=new Map,s=RegExp(`(?:${C})(.*?)(?:${I})`,"gm");for(let u of t.matchAll(s)){let c=u[1],f=`dsEscaped${De(c)}`;i.set(f,c),t=t.replace(C+c+I,f)}let a=(u,c)=>`${u}${$(c).replaceAll(/\./g,"_")}`,o=new Set,r=RegExp(`@(${Object.keys(F).join("|")})\\(`,"gm"),d=[...t.matchAll(r)],l=new Set,h=new Set;if(d.length){let u=`${x}Act_`;for(let c of d){let f=c[1],g=F[f];if(!g)continue;o.add(f);let y=a(u,f);t=t.replace(`@${f}(`,`${y}(`),l.add(y),h.add((...E)=>g.fn(e,...E))}}for(let[u,c]of i)t=t.replace(u,c);e.fnContent=t;try{let u=Function("el","$",...n?.argNames||[],...l,t);return(...c)=>{try{return u(e.el,R,...c,...h)}catch(f){throw e.runtimeErr("ExecuteExpression",{error:f.message})}}}catch(u){throw e.runtimeErr("GenerateExpression",{error:u.message})}}function De(e){let t=5831,n=e.length;for(;n--;)t+=(t<<5)+e.charCodeAt(n);return(t>>>0).toString(36)}z();export{z as apply,be as load,Se as setAlias};
//# sourceMappingURL=datastar-core.js.map
