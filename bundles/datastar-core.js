// Datastar v1.0.0-beta.9
var U=/ðŸ–•JS_DSðŸš€/.source,T=U.slice(0,5),C=U.slice(4),S="datastar";var ce={Morph:"morph",Inner:"inner",Outer:"outer",Prepend:"prepend",Append:"append",Before:"before",After:"after",UpsertAttributes:"upsertAttributes"},be=ce.Morph;var m=(e=>(e[e.Attribute=1]="Attribute",e[e.Watcher=2]="Watcher",e[e.Action=3]="Action",e))(m||{});var z=`${S}-signals`;var $=s=>s.replace(/[A-Z]+(?![a-z])|[A-Z]/g,(t,n)=>(n?"-":"")+t.toLowerCase()),D=s=>$(s).replace(/-./g,t=>t[1].toUpperCase()),P=s=>$(s).replace(/-/g,"_"),ue=s=>D(s).replace(/^./,t=>t[0].toUpperCase()),B=s=>new Function(`return Object.assign({}, ${s})`)();var pe={kebab:$,snake:P,pascal:ue};function O(s,t){for(let n of t.get("case")||[]){let e=pe[n];e&&(s=e(s))}return s}var de="computed",Z={type:1,name:de,keyReq:1,valReq:1,onLoad:({key:s,mods:t,signals:n,genRX:e})=>{s=O(s,t);let{deps:r,rxFn:i}=e();n.setComputed(s,r,i)}};var Y={type:1,name:"signals",onLoad:s=>{let{key:t,mods:n,signals:e,value:r,genRX:i}=s,o=n.has("ifmissing"),{rxFn:a}=i();if(t!==""){let l=O(t,n),c=r===""?r:a();o?e.upsertIfMissing(l,c):e.setValue(l,c)}else{let l=B(s.value);s.value=JSON.stringify(l);let c=a();e.merge(c,o)}}};var Q={type:1,name:"star",keyReq:2,valReq:2,onLoad:()=>{alert("YOU ARE PROBABLY OVERCOMPLICATING IT")}};var x=class{#e=0;#t;constructor(t=S){this.#t=t}with(t){if(typeof t=="string")for(let n of t.split(""))this.with(n.charCodeAt(0));else typeof t=="boolean"?this.with(1<<(t?7:3)):this.#e=this.#e*33^t;return this}get value(){return this.#e}get string(){return this.#t+Math.abs(this.#e).toString(36)}};function ee(s){if(s.id)return s.id;let t=new x,n=s;for(;n;){if(t.with(n.tagName||""),n.id){t.with(n.id);break}let e=n?.parentNode;e&&t.with([...e.children].indexOf(n)),n=e}return t.string}function te(s,t){return new x().with(s).with(t).value}function F(s,t){if(!s||!(s instanceof HTMLElement||s instanceof SVGElement))return null;let n=s.dataset;if("starIgnore"in n)return null;"starIgnore__self"in n||t(s);let e=s.firstElementChild;for(;e;)F(e,t),e=e.nextElementSibling}var ge="https://data-star.dev/errors";function I(s,t,n={}){let e=new Error;e.name=`${S} ${s} error`;let r=P(t),i=new URLSearchParams({metadata:JSON.stringify(n)}).toString(),o=JSON.stringify(n,null,2);return e.message=`${t}
More info: ${ge}/${s}/${r}?${i}
Context: ${o}`,e}function L(s,t,n={}){return I("internal",t,Object.assign({from:s},n))}function ne(s,t,n={}){let e={plugin:{name:t.plugin.name,type:m[t.plugin.type]}};return I("init",s,Object.assign(e,n))}function f(s,t,n={}){let e={plugin:{name:t.plugin.name,type:m[t.plugin.type]},element:{id:t.el.id,tag:t.el.tagName},expression:{rawKey:t.rawKey,key:t.key,value:t.value,validSignals:t.signals.paths(),fnContent:t.fnContent}};return I("runtime",s,Object.assign(e,n))}var se="namespacedSignals",A=s=>{document.dispatchEvent(new CustomEvent(z,{detail:Object.assign({added:[],removed:[],updated:[]},s)}))};function re(s,t=!1){let n={};for(let e in s)if(Object.hasOwn(s,e)){if(t&&e.startsWith("_"))continue;let r=s[e];r instanceof w?n[e]=r.value:n[e]=re(r)}return n}function ie(s,t,n,e=!1){let r={added:[],removed:[],updated:[]};for(let i in t)if(Object.hasOwn(t,i)){if(i.match(/\_\_+/))throw L(se,"InvalidSignalKey",{key:i});let o=n?`${n}.${i}`:i,a=t[i];if(a instanceof Object&&!Array.isArray(a)){s[i]||(s[i]={});let l=ie(s[i],a,o,e);r.added.push(...l.added.map(c=>`${o}.${c}`)),r.removed.push(...l.removed.map(c=>`${o}.${c}`)),r.updated.push(...l.updated.map(c=>`${o}.${c}`))}else{if(Object.hasOwn(s,i)){if(e)continue;let d=s[i];if(d instanceof E){let h=d.value;d.value=a,h!==a&&r.updated.push(o);continue}}let c=new E(a,()=>A({updated:[o]}));s[i]=c,r.added.push(o)}}return r}function oe(s,t){for(let n in s)if(Object.hasOwn(s,n)){let e=s[n];e instanceof w?t(n,e):oe(e,(r,i)=>{t(`${n}.${r}`,i)})}}function fe(s,...t){let n={};for(let e of t){let r=e.split("."),i=s,o=n;for(let l=0;l<r.length-1;l++){let c=r[l];if(!i[c])return{};o[c]||(o[c]={}),i=i[c],o=o[c]}let a=r[r.length-1];o[a]=i[a]}return n}var N=class{#e={};exists(t){return!!this.signal(t)}signal(t){let n=t.split("."),e=this.#e;for(let o=0;o<n.length-1;o++){let a=n[o];if(!e[a])return null;e=e[a]}let r=n[n.length-1],i=e[r];if(!i)throw L(se,"SignalNotFound",{path:t});return i}setSignal(t,n){let e=t.split("."),r=this.#e;for(let o=0;o<e.length-1;o++){let a=e[o];r[a]||(r[a]={}),r=r[a]}let i=e[e.length-1];r[i]=n}setComputed(t,n,e){let r=me(n,e);this.setSignal(t,r)}value(t){return this.signal(t)?.value}setValue(t,n){let{signal:e}=this.upsertIfMissing(t,n),r=e.value;e.value=n,r!==n&&A({updated:[t]})}upsertIfMissing(t,n){let e=t.split("."),r=this.#e;for(let l=0;l<e.length-1;l++){let c=e[l];r[c]||(r[c]={}),r=r[c]}let i=e[e.length-1],o=r[i];if(o instanceof E)return{signal:o,inserted:!1};let a=new E(n);return a.onChange=()=>{A({updated:[t]})},r[i]=a,A({added:[t]}),{signal:a,inserted:!0}}remove(...t){if(!t.length){this.#e={};return}let n=Array();for(let e of t){let r=e.split("."),i=this.#e;for(let a=0;a<r.length-1;a++){let l=r[a];if(!i[l])return;i=i[l]}let o=r[r.length-1];delete i[o],n.push(e)}A({removed:n})}merge(t,n=!1){let e=ie(this.#e,t,"",n);(e.added.length||e.removed.length||e.updated.length)&&A(e)}subset(...t){return fe(this.values(),...t)}walk(t){oe(this.#e,t)}paths(){let t=new Array;return this.walk(n=>t.push(n)),t}values(t=!1){return re(this.#e,t)}JSON(t=!0,n=!1){let e=this.values(n);return t?JSON.stringify(e,null,2):JSON.stringify(e)}toString(){return this.JSON()}};var w=class{},E=class extends w{constructor(n,e){super();this.val=n;this.onChange=e;this.subs=new Set;this.ver=1}set value(n){this.val!==n&&(this.val=n,this.ver++,this.markDirty(),this.onChange?.(n))}markDirty(){for(let n of this.subs)n.markDirty()}get value(){return this.val}version(){return this.ver}addSubscribers(...n){for(let e of n)this.subs.add(e)}removeSubscribers(...n){for(let e of n)this.subs.delete(e)}};var G=class extends w{constructor(n,e){super();this.deps=n;this.fn=e;this.subs=new Set;this.isDirty=!0;this.ver=1;this.versionSum=0;for(let r of n)r.addSubscribers(this)}get value(){if(!this.isDirty)return this.val;this.isDirty=!1;let n=0;for(let i of this.deps)n+=i.version();if(n===this.versionSum)return this.val;this.versionSum=n;let e=this.deps.map(i=>i.value),r=this.fn(...e);return this.val===r?this.val:(this.val=r,this.ver++,this.val)}version(){return this.ver}markDirty(){this.isDirty=!0;for(let n of this.subs)n.markDirty()}addSubscribers(...n){for(let e of n)this.subs.add(e)}removeSubscribers(...n){for(let e of n)this.subs.delete(e)}};function me(s,t){return new G(s,t)}var j=class{constructor(t,n){this.deps=t;this.fn=n;this.depsVersionSum=-1;for(let e of t)e.addSubscribers(this)}markDirty(){let t=0;for(let e of this.deps)t+=e.version();if(t===this.depsVersionSum)return;this.depsVersionSum=t;let n=this.deps.map(e=>e.value);this.fn(...n)}};function K(s,t){let n=new j(s,t);return n.markDirty(),()=>{for(let e of s)e.removeSubscribers(n)}}var ae=new N,k={},_=[],y=new Map,H=null,q="";function le(s){q=s}function W(...s){for(let t of s){let n={plugin:t,signals:ae,effect:(r,i)=>K(r,i),actions:k,removals:y,applyToElement:V},e;switch(t.type){case 3:{k[t.name]=t;break}case 1:{let r=t;_.push(r),e=r.onGlobalInit;break}case 2:{e=t.onGlobalInit;break}default:throw ne("InvalidPluginType",n)}e&&e(n)}_.sort((t,n)=>{let e=n.name.length-t.name.length;return e!==0?e:t.name.localeCompare(n.name)})}function J(){queueMicrotask(()=>{V(document.documentElement),he()})}function V(s){F(s,t=>{let n=new Array,e=y.get(t.id)||new Map,r=new Map([...e]),i=new Map;for(let o of Object.keys(t.dataset)){if(!o.startsWith(q))break;let a=t.dataset[o]||"",l=te(o,a);i.set(o,l),e.has(l)?r.delete(l):n.push(o)}for(let[o,a]of r)a();for(let o of n){let a=i.get(o);ye(t,o,a)}})}function he(){H||(H=new MutationObserver(s=>{let t=new Set,n=new Set;for(let{target:e,type:r,addedNodes:i,removedNodes:o}of s)switch(r){case"childList":{for(let a of o)t.add(a);for(let a of i)n.add(a)}break;case"attributes":{n.add(e);break}}for(let e of t){let r=y.get(e.id);if(r){for(let[i,o]of r)o(),r.delete(i);r.size===0&&y.delete(e.id)}}for(let e of n)V(e)}),H.observe(document.body,{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0}))}function ye(s,t,n){let e=D(t.slice(q.length)),r=_.find(p=>new RegExp(`^${p.name}([A-Z]|_|$)`).test(e));if(!r)return;s.id.length||(s.id=ee(s));let[i,...o]=e.slice(r.name.length).split(/\_\_+/),a=i.length>0;a&&(i=D(i));let l=s.dataset[t]||"",c=l.length>0,d={signals:ae,applyToElement:V,effect:(p,g)=>K(p,g),actions:k,removals:y,genRX:()=>ve(d,...r.argNames||[]),plugin:r,el:s,rawKey:e,key:i,value:l,mods:new Map},h=r.keyReq||0;if(a){if(h===2)throw f(`${r.name}KeyNotAllowed`,d)}else if(h===1)throw f(`${r.name}KeyRequired`,d);let v=r.valReq||0;if(c){if(v===2)throw f(`${r.name}ValueNotAllowed`,d)}else if(v===1)throw f(`${r.name}ValueRequired`,d);if(h===3||v===3){if(a&&c)throw f(`${r.name}KeyAndValueProvided`,d);if(!a&&!c)throw f(`${r.name}KeyOrValueRequired`,d)}for(let p of o){let[g,...b]=p.split(".");d.mods.set(D(g),new Set(b.map(M=>M.toLowerCase())))}let R=r.onLoad(d)??(()=>{}),u=y.get(s.id);u||(u=new Map,y.set(s.id,u)),u.set(n,R)}function ve(s,...t){let n=new Array,e="",r=/(\/(\\\/|[^\/])*\/|"(\\"|[^\"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|[^;])+/gm,i=s.value.trim().match(r);if(i){let u=i.length-1,p=i[u].trim();p.startsWith("return")||(i[u]=`return (${p});`),e=i.join(`;
`)}let o=new Map,a=new RegExp(`(?:${T})(.*?)(?:${C})`,"gm");for(let u of e.matchAll(a)){let p=u[1],g=new x("dsEscaped").with(p).string;o.set(g,p),e=e.replace(T+p+C,g)}let l=/@(\w*)\(/gm,c=e.matchAll(l),d=new Set;for(let u of c)d.add(u[1]);let h=new RegExp(`@(${Object.keys(k).join("|")})\\(`,"gm");e=e.replaceAll(h,"ctx.actions.$1.fn(ctx,");let v=s.signals.paths();if(v.length){let u=new RegExp(`\\$(${v.join("|")})(\\W|$)`,"gm");e=e.replaceAll(u,"ctx.signals.signal('$1').value$2");let p=/ctx.signals.signal\('(.+?)'\).value/gm;for(let g of e.matchAll(p)){let b=g[1],M=s.signals.signal(b);M&&n.push(M)}if(e.includes("ctx.signals.JSON()"))for(let g of s.signals.paths()){let b=s.signals.signal(g);b&&n.push(b)}}for(let[u,p]of o)e=e.replace(u,p);let R=`return (() => {
${e}
})()`;s.fnContent=R;try{let u=new Function("ctx",...t,R);return{deps:n,rxFn:(...p)=>{try{return u(s,...p)}catch(g){throw f("ExecuteExpression",s,{error:g.message})}}}}catch(u){throw f("GenerateExpression",s,{error:u.message})}}W(Q,Y,Z);J();export{J as apply,W as load,le as setAlias};
//# sourceMappingURL=datastar-core.js.map
