// Datastar v1.0.0-beta.9
var J=/ðŸ–•JS_DSðŸš€/.source,M=J.slice(0,5),V=J.slice(4),S="datastar";var ce={Morph:"morph",Inner:"inner",Outer:"outer",Prepend:"prepend",Append:"append",Before:"before",After:"after",UpsertAttributes:"upsertAttributes"},be=ce.Morph;var m=(n=>(n[n.Attribute=1]="Attribute",n[n.Watcher=2]="Watcher",n[n.Action=3]="Action",n))(m||{});var U=`${S}-signals`;var C=s=>s.replace(/[A-Z]+(?![a-z])|[A-Z]/g,(t,e)=>(e?"-":"")+t.toLowerCase()),D=s=>C(s).replace(/-./g,t=>t[1].toUpperCase()),$=s=>C(s).replace(/-/g,"_"),ue=s=>D(s).replace(/^./,t=>t[0].toUpperCase()),z=s=>new Function(`return Object.assign({}, ${s})`)();var pe={kebab:C,snake:$,pascal:ue};function T(s,t){for(let e of t.get("case")||[]){let n=pe[e];n&&(s=n(s))}return s}var de="computed",X={type:1,name:de,keyReq:1,valReq:1,onLoad:({key:s,mods:t,signals:e,genRX:n})=>{s=T(s,t);let{deps:r,rxFn:o}=n();e.setComputed(s,r,o)}};var Z={type:1,name:"signals",onLoad:s=>{let{key:t,mods:e,signals:n,value:r,genRX:o}=s,i=e.has("ifmissing"),{rxFn:a}=o();if(t!==""){let l=T(t,e),c=r===""?r:a();i?n.upsertIfMissing(l,c):n.setValue(l,c)}else{let l=z(s.value);s.value=JSON.stringify(l);let c=a();n.merge(c,i)}}};var Y={type:1,name:"star",keyReq:2,valReq:2,onLoad:()=>{alert("YOU ARE PROBABLY OVERCOMPLICATING IT")}};var x=class{#e=0;#t;constructor(t=S){this.#t=t}with(t){if(typeof t=="string")for(let e of t.split(""))this.with(e.charCodeAt(0));else typeof t=="boolean"?this.with(1<<(t?7:3)):this.#e=this.#e*33^t;return this}get value(){return this.#e}get string(){return this.#t+Math.abs(this.#e).toString(36)}};function Q(s){if(s.id)return s.id;let t=new x,e=s;for(;e;){if(t.with(e.tagName||""),e.id){t.with(e.id);break}let n=e?.parentNode;n&&t.with([...n.children].indexOf(e)),e=n}return t.string}function ee(s,t){return new x().with(s).with(t).value}function P(s,t){if(!s||!(s instanceof HTMLElement||s instanceof SVGElement))return null;let e=s.dataset;if("starIgnore"in e)return null;"starIgnore__self"in e||t(s);let n=s.firstElementChild;for(;n;)P(n,t),n=n.nextElementSibling}var ge="https://data-star.dev/errors";function F(s,t,e={}){let n=new Error;n.name=`${S} ${s} error`;let r=$(t),o=new URLSearchParams({metadata:JSON.stringify(e)}).toString(),i=JSON.stringify(e,null,2);return n.message=`${t}
More info: ${ge}/${s}/${r}?${o}
Context: ${i}`,n}function I(s,t,e={}){return F("internal",t,Object.assign({from:s},e))}function te(s,t,e={}){let n={plugin:{name:t.plugin.name,type:m[t.plugin.type]}};return F("init",s,Object.assign(n,e))}function f(s,t,e={}){let n={plugin:{name:t.plugin.name,type:m[t.plugin.type]},element:{id:t.el.id,tag:t.el.tagName},expression:{rawKey:t.rawKey,key:t.key,value:t.value,validSignals:t.signals.paths(),fnContent:t.fnContent}};return F("runtime",s,Object.assign(n,e))}var ne="namespacedSignals",A=s=>{document.dispatchEvent(new CustomEvent(U,{detail:Object.assign({added:[],removed:[],updated:[]},s)}))};function se(s,t=!1){let e={};for(let n in s)if(Object.hasOwn(s,n)){if(t&&n.startsWith("_"))continue;let r=s[n];r instanceof w?e[n]=r.value:e[n]=se(r)}return e}function re(s,t,e,n=!1){let r={added:[],removed:[],updated:[]};for(let o in t)if(Object.hasOwn(t,o)){if(o.match(/\_\_+/))throw I(ne,"InvalidSignalKey",{key:o});let i=e?`${e}.${o}`:o,a=t[o];if(a instanceof Object&&!Array.isArray(a)){s[o]||(s[o]={});let l=re(s[o],a,i,n);r.added.push(...l.added.map(c=>`${i}.${c}`)),r.removed.push(...l.removed.map(c=>`${i}.${c}`)),r.updated.push(...l.updated.map(c=>`${i}.${c}`))}else{if(Object.hasOwn(s,o)){if(n)continue;let d=s[o];if(d instanceof E){let h=d.value;d.value=a,h!==a&&r.updated.push(i);continue}}let c=new E(a,()=>A({updated:[i]}));s[o]=c,r.added.push(i)}}return r}function oe(s,t){for(let e in s)if(Object.hasOwn(s,e)){let n=s[e];n instanceof w?t(e,n):oe(n,(r,o)=>{t(`${e}.${r}`,o)})}}function fe(s,...t){let e={};for(let n of t){let r=n.split("."),o=s,i=e;for(let l=0;l<r.length-1;l++){let c=r[l];if(!o[c])return{};i[c]||(i[c]={}),o=o[c],i=i[c]}let a=r[r.length-1];i[a]=o[a]}return e}var N=class{#e={};exists(t){return!!this.signal(t)}signal(t){let e=t.split("."),n=this.#e;for(let i=0;i<e.length-1;i++){let a=e[i];if(!n[a])return null;n=n[a]}let r=e[e.length-1],o=n[r];if(!o)throw I(ne,"SignalNotFound",{path:t});return o}setSignal(t,e){let n=t.split("."),r=this.#e;for(let i=0;i<n.length-1;i++){let a=n[i];r[a]||(r[a]={}),r=r[a]}let o=n[n.length-1];r[o]=e}setComputed(t,e,n){let r=me(e,n);this.setSignal(t,r)}value(t){return this.signal(t)?.value}setValue(t,e){let{signal:n}=this.upsertIfMissing(t,e),r=n.value;n.value=e,r!==e&&A({updated:[t]})}upsertIfMissing(t,e){let n=t.split("."),r=this.#e;for(let l=0;l<n.length-1;l++){let c=n[l];r[c]||(r[c]={}),r=r[c]}let o=n[n.length-1],i=r[o];if(i instanceof E)return{signal:i,inserted:!1};let a=new E(e);return a.onChange=()=>{A({updated:[t]})},r[o]=a,A({added:[t]}),{signal:a,inserted:!0}}remove(...t){if(!t.length){this.#e={};return}let e=Array();for(let n of t){let r=n.split("."),o=this.#e;for(let a=0;a<r.length-1;a++){let l=r[a];if(!o[l])return;o=o[l]}let i=r[r.length-1];delete o[i],e.push(n)}A({removed:e})}merge(t,e=!1){let n=re(this.#e,t,"",e);(n.added.length||n.removed.length||n.updated.length)&&A(n)}subset(...t){return fe(this.values(),...t)}walk(t){oe(this.#e,t)}paths(){let t=new Array;return this.walk(e=>t.push(e)),t}values(t=!1){return se(this.#e,t)}JSON(t=!0,e=!1){let n=this.values(e);return t?JSON.stringify(n,null,2):JSON.stringify(n)}toString(){return this.JSON()}};var w=class{},E=class extends w{constructor(e,n){super();this.val=e;this.onChange=n;this.subs=new Set;this.ver=1}set value(e){this.val!==e&&(this.val=e,this.ver++,this.markDirty(),this.onChange?.(e))}markDirty(){for(let e of this.subs)e.markDirty()}get value(){return this.val}version(){return this.ver}addSubscribers(...e){for(let n of e)this.subs.add(n)}removeSubscribers(...e){for(let n of e)this.subs.delete(n)}};var L=class extends w{constructor(e,n){super();this.deps=e;this.fn=n;this.subs=new Set;this.isDirty=!0;this.ver=1;this.versionSum=0;for(let r of e)r.addSubscribers(this)}get value(){if(!this.isDirty)return this.val;this.isDirty=!1;let e=0;for(let o of this.deps)e+=o.version();if(e===this.versionSum)return this.val;this.versionSum=e;let n=this.deps.map(o=>o.value),r=this.fn(...n);return this.val===r?this.val:(this.val=r,this.ver++,this.val)}version(){return this.ver}markDirty(){this.isDirty=!0;for(let e of this.subs)e.markDirty()}addSubscribers(...e){for(let n of e)this.subs.add(n)}removeSubscribers(...e){for(let n of e)this.subs.delete(n)}};function me(s,t){return new L(s,t)}var G=class{constructor(t,e){this.deps=t;this.fn=e;this.depsVersionSum=-1;for(let n of t)n.addSubscribers(this)}markDirty(){let t=0;for(let n of this.deps)t+=n.version();if(t===this.depsVersionSum)return;this.depsVersionSum=t;let e=this.deps.map(n=>n.value);this.fn(...e)}};function j(s,t){let e=new G(s,t);return e.markDirty(),()=>{for(let n of s)n.removeSubscribers(e)}}var ie=new N,O={},H=[],v=new Map,K=null,_="";function ae(s){_=s}function q(...s){for(let t of s){let e={plugin:t,signals:ie,effect:(r,o)=>j(r,o),actions:O,removals:v,applyToElement:k},n;switch(t.type){case 3:{O[t.name]=t;break}case 1:{let r=t;H.push(r),n=r.onGlobalInit;break}case 2:{n=t.onGlobalInit;break}default:throw te("InvalidPluginType",e)}n&&n(e)}H.sort((t,e)=>{let n=e.name.length-t.name.length;return n!==0?n:t.name.localeCompare(e.name)})}function W(){queueMicrotask(()=>{k(document.documentElement),he()})}function k(s){P(s,t=>{let e=new Array,n=v.get(t.id)||new Map,r=new Map([...n]),o=new Map;for(let i of Object.keys(t.dataset)){if(!i.startsWith(_))break;let a=t.dataset[i]||"",l=ee(i,a);o.set(i,l),n.has(l)?r.delete(l):e.push(i)}for(let[i,a]of r)a();for(let i of e){let a=o.get(i);ye(t,i,a)}})}function he(){K||(K=new MutationObserver(s=>{let t=new Set,e=new Set;for(let{target:n,type:r,addedNodes:o,removedNodes:i}of s)switch(r){case"childList":{for(let a of i)t.add(a);for(let a of o)e.add(a)}break;case"attributes":{e.add(n);break}}for(let n of t){let r=v.get(n.id);if(r){for(let[o,i]of r)i(),r.delete(o);r.size===0&&v.delete(n.id)}}for(let n of e)k(n)}),K.observe(document.body,{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0}))}function ye(s,t,e){let n=D(t.slice(_.length)),r=H.find(u=>new RegExp(`^${u.name}([A-Z]|_|$)`).test(n));if(!r)return;s.id.length||(s.id=Q(s));let[o,...i]=n.slice(r.name.length).split(/\_\_+/),a=o.length>0;a&&(o=D(o));let l=s.dataset[t]||"",c=l.length>0,d={signals:ie,applyToElement:k,effect:(u,p)=>j(u,p),actions:O,removals:v,genRX:()=>ve(d,...r.argNames||[]),plugin:r,el:s,rawKey:n,key:o,value:l,mods:new Map},h=r.keyReq||0;if(a){if(h===2)throw f(`${r.name}KeyNotAllowed`,d)}else if(h===1)throw f(`${r.name}KeyRequired`,d);let b=r.valReq||0;if(c){if(b===2)throw f(`${r.name}ValueNotAllowed`,d)}else if(b===1)throw f(`${r.name}ValueRequired`,d);if(h===3||b===3){if(a&&c)throw f(`${r.name}KeyAndValueProvided`,d);if(!a&&!c)throw f(`${r.name}KeyOrValueRequired`,d)}for(let u of i){let[p,...g]=u.split(".");d.mods.set(D(p),new Set(g.map(le=>le.toLowerCase())))}let R=r.onLoad(d)??(()=>{}),y=v.get(s.id);y||(y=new Map,v.set(s.id,y)),y.set(e,R)}function ve(s,...t){let e="",n=new Set,r=/(\/(\\\/|[^\/])*\/|"(\\"|[^\"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|[^;])+/gm,o=s.value.trim().match(r);if(o){let u=o.length-1,p=o[u].trim();p.startsWith("return")||(o[u]=`return (${p});`),e=o.join(`;
`)}let i=new Map,a=new RegExp(`(?:${M})(.*?)(?:${V})`,"gm");for(let u of e.matchAll(a)){let p=u[1],g=new x("dsEscaped").with(p).string;i.set(g,p),e=e.replace(M+p+V,g)}let l=/@(\w*)\(/gm,c=e.matchAll(l),d=new Set;for(let u of c)d.add(u[1]);let h=new RegExp(`@(${Object.keys(O).join("|")})\\(`,"gm");e=e.replaceAll(h,"ctx.actions.$1.fn(ctx,");let b=s.signals.paths();if(b.length){let u=new RegExp(`\\$(${b.join("|")})(\\W|$)`,"gm");e=e.replaceAll(u,"ctx.signals.signal('$1').value$2");let p=/ctx.signals.signal\('(.+?)'\).value/gm;for(let g of e.matchAll(p))n.add(g[1]);if(e.includes("ctx.signals.JSON()"))for(let g of s.signals.paths())n.add(g)}let R=new Array;for(let u of n){let p=s.signals.signal(u);p&&R.push(p)}for(let[u,p]of i)e=e.replace(u,p);let y=`return (() => {
${e}
})()`;s.fnContent=y;try{let u=new Function("ctx",...t,y);return{deps:R,rxFn:(...p)=>{try{return u(s,...p)}catch(g){throw f("ExecuteExpression",s,{error:g.message})}}}}catch(u){throw f("GenerateExpression",s,{error:u.message})}}q(Y,Z,X);W();export{W as apply,q as load,ae as setAlias};
//# sourceMappingURL=datastar-core.js.map
