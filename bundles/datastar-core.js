// Datastar v1.0.0-beta.9
var U=/ðŸ–•JS_DSðŸš€/.source,M=U.slice(0,5),V=U.slice(4),x="datastar";var ue={Morph:"morph",Inner:"inner",Outer:"outer",Prepend:"prepend",Append:"append",Before:"before",After:"after",UpsertAttributes:"upsertAttributes"},Se=ue.Morph;var m=(e=>(e[e.Attribute=1]="Attribute",e[e.Watcher=2]="Watcher",e[e.Action=3]="Action",e))(m||{});var J=`${x}-signals`;var C=s=>s.replace(/[A-Z]+(?![a-z])|[A-Z]/g,(t,n)=>(n?"-":"")+t.toLowerCase()),D=s=>C(s).replace(/-./g,t=>t[1].toUpperCase()),P=s=>C(s).replace(/-/g,"_"),pe=s=>D(s).replace(/^./,t=>t[0].toUpperCase()),z=s=>new Function(`return Object.assign({}, ${s})`)();var de={kebab:C,snake:P,pascal:pe};function T(s,t){for(let n of t.get("case")||[]){let e=de[n];e&&(s=e(s))}return s}var fe="computed",X={type:1,name:fe,keyReq:1,valReq:1,onLoad:({key:s,mods:t,signals:n,genRX:e})=>{s=T(s,t);let r=e();n.setComputed(s,r)}};var Y={type:1,name:"signals",onLoad:s=>{let{key:t,mods:n,signals:e,value:r,genRX:o}=s,i=n.has("ifmissing"),{rxFn:a}=o();if(t!==""){let l=T(t,n),c=r===""?r:a();i?e.upsertIfMissing(l,c):e.setValue(l,c)}else{let l=z(s.value);s.value=JSON.stringify(l);let c=a();e.merge(c,i)}}};var Z={type:1,name:"star",keyReq:2,valReq:2,onLoad:()=>{alert("YOU ARE PROBABLY OVERCOMPLICATING IT")}};var A=class{#e=0;#t;constructor(t=x){this.#t=t}with(t){if(typeof t=="string")for(let n of t.split(""))this.with(n.charCodeAt(0));else typeof t=="boolean"?this.with(1<<(t?7:3)):this.#e=this.#e*33^t;return this}get value(){return this.#e}get string(){return this.#t+Math.abs(this.#e).toString(36)}};function Q(s){if(s.id)return s.id;let t=new A,n=s;for(;n;){if(t.with(n.tagName||""),n.id){t.with(n.id);break}let e=n?.parentNode;e&&t.with([...e.children].indexOf(n)),n=e}return t.string}function ee(s,t){return new A().with(s).with(t).value}function $(s,t){if(!s||!(s instanceof HTMLElement||s instanceof SVGElement))return null;let n=s.dataset;if("starIgnore"in n)return null;"starIgnore__self"in n||t(s);let e=s.firstElementChild;for(;e;)$(e,t),e=e.nextElementSibling}var y=class{},v=class extends y{constructor(n,e){super();this.val=n;this.onChange=e;this.subs=new Set;this.ver=1}set value(n){this.val!==n&&(this.val=n,this.ver++,this.markDirty(),this.onChange?.(n))}markDirty(){for(let n of this.subs)n.markDirty()}get value(){return this.val}version(){return this.ver}addSubscribers(...n){for(let e of n)this.subs.add(e)}removeSubscribers(...n){for(let e of n)this.subs.delete(e)}};var F=class extends y{constructor(n,e){super();this.deps=n;this.fn=e;this.subs=new Set;this.isDirty=!0;this.ver=1;this.versionSum=0;for(let r of n)r.addSubscribers(this)}get value(){if(!this.isDirty)return this.val;this.isDirty=!1;let n=0;for(let o of this.deps)n+=o.version();if(n===this.versionSum)return this.val;this.versionSum=n;let e=this.deps.map(o=>o.value),r=this.fn(...e);return this.val===r?this.val:(this.val=r,this.ver++,this.val)}version(){return this.ver}markDirty(){this.isDirty=!0;for(let n of this.subs)n.markDirty()}addSubscribers(...n){for(let e of n)this.subs.add(e)}removeSubscribers(...n){for(let e of n)this.subs.delete(e)}};function te(s,t){return new F(s,t)}var I=class{constructor(t,n){this.deps=t;this.fn=n;this.depsVersionSum=-1;for(let e of t)e.addSubscribers(this)}markDirty(){let t=0;for(let e of this.deps)t+=e.version();if(t===this.depsVersionSum)return;this.depsVersionSum=t;let n=this.deps.map(e=>e.value);this.fn(...n)}};function L(s,t){let n=new I(s,t);return n.markDirty(),()=>{for(let e of s)e.removeSubscribers(n)}}var ge="https://data-star.dev/errors";function G(s,t,n={}){let e=new Error;e.name=`${x} ${s} error`;let r=P(t),o=new URLSearchParams({metadata:JSON.stringify(n)}).toString(),i=JSON.stringify(n,null,2);return e.message=`${t}
More info: ${ge}/${s}/${r}?${o}
Context: ${i}`,e}function j(s,t,n={}){return G("internal",t,Object.assign({from:s},n))}function ne(s,t,n={}){let e={plugin:{name:t.plugin.name,type:m[t.plugin.type]}};return G("init",s,Object.assign(e,n))}function g(s,t,n={}){let e={plugin:{name:t.plugin.name,type:m[t.plugin.type]},element:{id:t.el.id,tag:t.el.tagName},expression:{rawKey:t.rawKey,key:t.key,value:t.value,validSignals:t.signals.paths(),fnContent:t.fnContent}};return G("runtime",s,Object.assign(e,n))}var se="namespacedSignals",w=s=>{document.dispatchEvent(new CustomEvent(J,{detail:Object.assign({added:[],removed:[],updated:[]},s)}))};function re(s,t=!1){let n={};for(let e in s)if(Object.hasOwn(s,e)){if(t&&e.startsWith("_"))continue;let r=s[e];r instanceof y?n[e]=r.value:n[e]=re(r)}return n}function oe(s,t,n,e=!1){let r={added:[],removed:[],updated:[]};for(let o in t)if(Object.hasOwn(t,o)){if(o.match(/\_\_+/))throw j(se,"InvalidSignalKey",{key:o});let i=n?`${n}.${o}`:o,a=t[o];if(a instanceof Object&&!Array.isArray(a)){s[o]||(s[o]={});let l=oe(s[o],a,i,e);r.added.push(...l.added.map(c=>`${i}.${c}`)),r.removed.push(...l.removed.map(c=>`${i}.${c}`)),r.updated.push(...l.updated.map(c=>`${i}.${c}`))}else{if(Object.hasOwn(s,o)){if(e)continue;let d=s[o];if(d instanceof v){let h=d.value;d.value=a,h!==a&&r.updated.push(i);continue}}let c=new v(a,()=>w({updated:[i]}));s[o]=c,r.added.push(i)}}return r}function ie(s,t){for(let n in s)if(Object.hasOwn(s,n)){let e=s[n];e instanceof y?t(n,e):ie(e,(r,o)=>{t(`${n}.${r}`,o)})}}function me(s,...t){let n={};for(let e of t){let r=e.split("."),o=s,i=n;for(let l=0;l<r.length-1;l++){let c=r[l];if(!o[c])return{};i[c]||(i[c]={}),o=o[c],i=i[c]}let a=r[r.length-1];i[a]=o[a]}return n}var O=class{#e={};exists(t){return!!this.signal(t)}signal(t){let n=t.split("."),e=this.#e;for(let i=0;i<n.length-1;i++){let a=n[i];if(!e[a])return null;e=e[a]}let r=n[n.length-1],o=e[r];if(!o)throw j(se,"SignalNotFound",{path:t});return o}setSignal(t,n){let e=t.split("."),r=this.#e;for(let i=0;i<e.length-1;i++){let a=e[i];r[a]||(r[a]={}),r=r[a]}let o=e[e.length-1];r[o]=n}setComputed(t,n,e){let r=te(n,e);this.setSignal(t,r)}value(t){return this.signal(t)?.value}setValue(t,n){let{signal:e}=this.upsertIfMissing(t,n),r=e.value;e.value=n,r!==n&&w({updated:[t]})}upsertIfMissing(t,n){let e=t.split("."),r=this.#e;for(let l=0;l<e.length-1;l++){let c=e[l];r[c]||(r[c]={}),r=r[c]}let o=e[e.length-1],i=r[o];if(i instanceof v)return{signal:i,inserted:!1};let a=new v(n);return a.onChange=()=>{w({updated:[t]})},r[o]=a,w({added:[t]}),{signal:a,inserted:!0}}remove(...t){if(!t.length){this.#e={};return}let n=Array();for(let e of t){let r=e.split("."),o=this.#e;for(let a=0;a<r.length-1;a++){let l=r[a];if(!o[l])return;o=o[l]}let i=r[r.length-1];delete o[i],n.push(e)}w({removed:n})}merge(t,n=!1){let e=oe(this.#e,t,"",n);(e.added.length||e.removed.length||e.updated.length)&&w(e)}subset(...t){return me(this.values(),...t)}walk(t){ie(this.#e,t)}paths(){let t=new Array;return this.walk(n=>t.push(n)),t}values(t=!1){return re(this.#e,t)}JSON(t=!0,n=!1){let e=this.values(n);return t?JSON.stringify(e,null,2):JSON.stringify(e)}toString(){return this.JSON()}};var ae=new O,H=[],k={},he=[],b=new Map,K=null,_="";function le(s){_=s}function W(...s){for(let t of s){let n={plugin:t,signals:ae,effect:(r,o)=>L(r,o),actions:k,removals:b,applyToElement:N},e;switch(t.type){case 2:{let r=t;he.push(r),e=r.onGlobalInit;break}case 3:{k[t.name]=t;break}case 1:{let r=t;H.push(r),e=r.onGlobalInit;break}default:throw ne("InvalidPluginType",n)}e&&e(n)}H.sort((t,n)=>{let e=n.name.length-t.name.length;return e!==0?e:t.name.localeCompare(n.name)})}function q(){queueMicrotask(()=>{N(document.documentElement),ye()})}function N(s){$(s,t=>{let n=new Array,e=b.get(t.id)||new Map,r=new Map([...e]),o=new Map;for(let i of Object.keys(t.dataset)){if(!i.startsWith(_))break;let a=t.dataset[i]||"",l=ee(i,a);o.set(i,l),e.has(l)?r.delete(l):n.push(i)}for(let[i,a]of r)a();for(let i of n){let a=o.get(i);ve(t,i,a)}})}function ye(){K||(K=new MutationObserver(s=>{let t=new Set,n=new Set;for(let{target:e,type:r,addedNodes:o,removedNodes:i}of s)switch(r){case"childList":{for(let a of i)t.add(a);for(let a of o)n.add(a)}break;case"attributes":{n.add(e);break}}for(let e of t){let r=b.get(e.id);if(r){for(let[o,i]of r)i(),r.delete(o);r.size===0&&b.delete(e.id)}}for(let e of n)N(e)}),K.observe(document.body,{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0}))}function ve(s,t,n){let e=D(t.slice(_.length)),r=H.find(p=>e.startsWith(p.name));if(!r)return;s.id.length||(s.id=Q(s));let[o,...i]=e.slice(r.name.length).split(/\_\_+/),a=o.length>0;a&&(o=D(o));let l=s.dataset[t]||"",c=l.length>0,d={signals:ae,applyToElement:N,effect:(p,f)=>L(p,f),actions:k,removals:b,genRX:()=>be(d,...r.argNames||[]),plugin:r,el:s,rawKey:e,key:o,value:l,mods:new Map},h=r.keyReq||0;if(a){if(h===2)throw g(`${r.name}KeyNotAllowed`,d)}else if(h===1)throw g(`${r.name}KeyRequired`,d);let S=r.valReq||0;if(c){if(S===2)throw g(`${r.name}ValueNotAllowed`,d)}else if(S===1)throw g(`${r.name}ValueRequired`,d);if(h===3||S===3){if(a&&c)throw g(`${r.name}KeyAndValueProvided`,d);if(!a&&!c)throw g(`${r.name}KeyOrValueRequired`,d)}for(let p of i){let[f,...R]=p.split(".");d.mods.set(D(f),new Set(R.map(ce=>ce.toLowerCase())))}let E=r.onLoad(d)??(()=>{}),u=b.get(s.id);u||(u=new Map,b.set(s.id,u)),u.set(n,E)}function be(s,...t){let n=new Array,e="",r=/(\/(\\\/|[^\/])*\/|"(\\"|[^\"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|[^;])+/gm,o=s.value.trim().match(r);if(o){let u=o.length-1,p=o[u].trim();p.startsWith("return")||(o[u]=`return (${p});`),e=o.join(`;
`)}let i=new Map,a=new RegExp(`(?:${M})(.*?)(?:${V})`,"gm");for(let u of e.matchAll(a)){let p=u[1],f=new A("dsEscaped").with(p).string;i.set(f,p),e=e.replace(M+p+V,f)}let l=/@(\w*)\(/gm,c=e.matchAll(l),d=new Set;for(let u of c)d.add(u[1]);let h=new RegExp(`@(${Object.keys(k).join("|")})\\(`,"gm");e=e.replaceAll(h,"ctx.actions.$1.fn(ctx,");let S=s.signals.paths();if(S.length){let u=new RegExp(`\\$(${S.join("|")})(\\W|$)`,"gm");for(let p of e.matchAll(u)){let f=p[1],R=s.signals.signal(f);R&&n.push(R)}e=e.replaceAll(u,"ctx.signals.signal('$1').value$2")}for(let[u,p]of i)e=e.replace(u,p);let E=`return (()=> {
${e}
})()`;s.fnContent=E;try{let u=new Function("ctx",...t,E);return{deps:n,rxFn:(...p)=>{try{return u(s,...p)}catch(f){throw g("ExecuteExpression",s,{error:f.message})}}}}catch(u){throw g("GenerateExpression",s,{error:u.message})}}W(Z,Y,X);q();export{q as apply,W as load,le as setAlias};
//# sourceMappingURL=datastar-core.js.map
