// Datastar v1.0.0-beta.7
var re=/ðŸ–•JS_DSðŸš€/.source,O=re.slice(0,5),J=re.slice(4),E="datastar";var Oe={Morph:"morph",Inner:"inner",Outer:"outer",Prepend:"prepend",Append:"append",Before:"before",After:"after",UpsertAttributes:"upsertAttributes"},Ke=Oe.Morph;var S=(s=>(s[s.Attribute=1]="Attribute",s[s.Watcher=2]="Watcher",s[s.Action=3]="Action",s))(S||{});var ie=`${E}-signals`;var U=t=>t.replace(/[A-Z]+(?![a-z])|[A-Z]/g,(e,n)=>(n?"-":"")+e.toLowerCase()),M=t=>U(t).replace(/-./g,e=>e[1].toUpperCase()),z=t=>U(t).replace(/-/g,"_"),Me=t=>M(t).replace(/^./,e=>e[0].toUpperCase()),oe=t=>new Function(`return Object.assign({}, ${t})`)();var ke={kebab:U,snake:z,pascal:Me};function $(t,e){for(let n of e.get("case")||[]){let s=ke[n];s&&(t=s(t))}return t}var De="computed",le={type:1,name:De,keyReq:1,valReq:1,onLoad:({key:t,mods:e,signals:n,genRX:s})=>{t=$(t,e);let r=s();n.setComputed(t,r)}};var ue={type:1,name:"signals",removeOnLoad:()=>!0,onLoad:t=>{let{key:e,mods:n,signals:s,value:r,genRX:o}=t,a=n.has("ifmissing");if(e!==""){let i=$(e,n),l=r===""?r:o()();a?s.upsertIfMissing(i,l):s.setValue(i,l)}else{let i=oe(t.value);t.value=JSON.stringify(i);let u=o()();s.merge(u,a)}}};var ce={type:1,name:"star",keyReq:2,valReq:2,onLoad:()=>{alert("YOU ARE PROBABLY OVERCOMPLICATING IT")}};var k=class{#e=0;#t;constructor(e=E){this.#t=e}with(e){if(typeof e=="string")for(let n of e.split(""))this.with(n.charCodeAt(0));else this.#e=(this.#e<<5)-this.#e+e;return this}get value(){return this.#t+Math.abs(this.#e).toString(36)}};function fe(t){if(t.id)return t.id;let e=new k,n=t;for(;n;){if(n.id){e.with(n.id);break}let s=n?.parentNode;s?e.with([...s.children].indexOf(n)):e.with(n.tagName),n=s}return e.value}function Y(t,e){if(!t||!(t instanceof HTMLElement||t instanceof SVGElement))return null;let n=t.dataset;if("starIgnore"in n)return null;"starIgnore__self"in n||e(t);let s=t.firstElementChild;for(;s;)Y(s,e),s=s.nextElementSibling}function de(t,e){return(...n)=>{setTimeout(()=>{t(...n)},e)}}var Ve="https://data-star.dev/errors";function X(t,e,n={}){let s=new Error;s.name=`${E} ${t} error`;let r=z(e),o=new URLSearchParams({metadata:JSON.stringify(n)}).toString(),a=JSON.stringify(n,null,2);return s.message=`${e}
More info: ${Ve}/${t}/${r}?${o}
Context: ${a}`,s}function _(t,e,n={}){return X("internal",e,Object.assign({from:t},n))}function pe(t,e,n={}){let s={plugin:{name:e.plugin.name,type:S[e.plugin.type]}};return X("init",t,Object.assign(s,n))}function x(t,e,n={}){let s={plugin:{name:e.plugin.name,type:S[e.plugin.type]},element:{id:e.el.id,tag:e.el.tagName},expression:{rawKey:e.rawKey,key:e.key,value:e.value,validSignals:e.signals.paths(),fnContent:e.fnContent}};return X("runtime",t,Object.assign(s,n))}var A="preact-signals",Pe=Symbol.for("preact-signals"),v=1,w=2,V=4,R=8,I=16,N=32;function Q(){F++}function ee(){if(F>1){F--;return}let t,e=!1;for(;D!==void 0;){let n=D;for(D=void 0,Z++;n!==void 0;){let s=n._nextBatchedEffect;if(n._nextBatchedEffect=void 0,n._flags&=~w,!(n._flags&R)&&he(n))try{n._callback()}catch(r){e||(t=r,e=!0)}n=s}}if(Z=0,F--,e)throw t}var c;var D,F=0,Z=0,L=0;function ge(t){if(c===void 0)return;let e=t._node;if(e===void 0||e._target!==c)return e={_version:0,_source:t,_prevSource:c._sources,_nextSource:void 0,_target:c,_prevTarget:void 0,_nextTarget:void 0,_rollbackNode:e},c._sources!==void 0&&(c._sources._nextSource=e),c._sources=e,t._node=e,c._flags&N&&t._subscribe(e),e;if(e._version===-1)return e._version=0,e._nextSource!==void 0&&(e._nextSource._prevSource=e._prevSource,e._prevSource!==void 0&&(e._prevSource._nextSource=e._nextSource),e._prevSource=c._sources,e._nextSource=void 0,c._sources._nextSource=e,c._sources=e),e}function f(t){this._value=t,this._version=0,this._node=void 0,this._targets=void 0}f.prototype.brand=Pe;f.prototype._refresh=()=>!0;f.prototype._subscribe=function(t){this._targets!==t&&t._prevTarget===void 0&&(t._nextTarget=this._targets,this._targets!==void 0&&(this._targets._prevTarget=t),this._targets=t)};f.prototype._unsubscribe=function(t){if(this._targets!==void 0){let e=t._prevTarget,n=t._nextTarget;e!==void 0&&(e._nextTarget=n,t._prevTarget=void 0),n!==void 0&&(n._prevTarget=e,t._nextTarget=void 0),t===this._targets&&(this._targets=n)}};f.prototype.subscribe=function(t){return G(()=>{let e=this.value,n=c;c=void 0;try{t(e)}finally{c=n}})};f.prototype.valueOf=function(){return this.value};f.prototype.toString=function(){return`${this.value}`};f.prototype.toJSON=function(){return this.value};f.prototype.peek=function(){let t=c;c=void 0;try{return this.value}finally{c=t}};Object.defineProperty(f.prototype,"value",{get(){let t=ge(this);return t!==void 0&&(t._version=this._version),this._value},set(t){if(t!==this._value){if(Z>100)throw _(A,"SignalCycleDetected");let e=this._value,n=t;this._value=t,this._version++,L++,Q();try{for(let s=this._targets;s!==void 0;s=s._nextTarget)s._target._notify()}finally{ee()}this?._onChange({old:e,revised:n})}}});function he(t){for(let e=t._sources;e!==void 0;e=e._nextSource)if(e._source._version!==e._version||!e._source._refresh()||e._source._version!==e._version)return!0;return!1}function me(t){for(let e=t._sources;e!==void 0;e=e._nextSource){let n=e._source._node;if(n!==void 0&&(e._rollbackNode=n),e._source._node=e,e._version=-1,e._nextSource===void 0){t._sources=e;break}}}function _e(t){let e=t._sources,n;for(;e!==void 0;){let s=e._prevSource;e._version===-1?(e._source._unsubscribe(e),s!==void 0&&(s._nextSource=e._nextSource),e._nextSource!==void 0&&(e._nextSource._prevSource=s)):n=e,e._source._node=e._rollbackNode,e._rollbackNode!==void 0&&(e._rollbackNode=void 0),e=s}t._sources=n}function T(t){f.call(this,void 0),this._fn=t,this._sources=void 0,this._globalVersion=L-1,this._flags=V}T.prototype=new f;T.prototype._refresh=function(){if(this._flags&=~w,this._flags&v)return!1;if((this._flags&(V|N))===N||(this._flags&=~V,this._globalVersion===L))return!0;if(this._globalVersion=L,this._flags|=v,this._version>0&&!he(this))return this._flags&=~v,!0;let t=c;try{me(this),c=this;let e=this._fn();(this._flags&I||this._value!==e||this._version===0)&&(this._value=e,this._flags&=~I,this._version++)}catch(e){this._value=e,this._flags|=I,this._version++}return c=t,_e(this),this._flags&=~v,!0};T.prototype._subscribe=function(t){if(this._targets===void 0){this._flags|=V|N;for(let e=this._sources;e!==void 0;e=e._nextSource)e._source._subscribe(e)}f.prototype._subscribe.call(this,t)};T.prototype._unsubscribe=function(t){if(this._targets!==void 0&&(f.prototype._unsubscribe.call(this,t),this._targets===void 0)){this._flags&=~N;for(let e=this._sources;e!==void 0;e=e._nextSource)e._source._unsubscribe(e)}};T.prototype._notify=function(){if(!(this._flags&w)){this._flags|=V|w;for(let t=this._targets;t!==void 0;t=t._nextTarget)t._target._notify()}};Object.defineProperty(T.prototype,"value",{get(){if(this._flags&v)throw _(A,"SignalCycleDetected");let t=ge(this);if(this._refresh(),t!==void 0&&(t._version=this._version),this._flags&I)throw _(A,"GetComputedError",{value:this._value});return this._value}});function ve(t){return new T(t)}function ye(t){let e=t._cleanup;if(t._cleanup=void 0,typeof e=="function"){Q();let n=c;c=void 0;try{e()}catch(s){throw t._flags&=~v,t._flags|=R,te(t),_(A,"CleanupEffectError",{error:s})}finally{c=n,ee()}}}function te(t){for(let e=t._sources;e!==void 0;e=e._nextSource)e._source._unsubscribe(e);t._fn=void 0,t._sources=void 0,ye(t)}function $e(t){if(c!==this)throw _(A,"EndEffectError");_e(this),c=t,this._flags&=~v,this._flags&R&&te(this),ee()}function P(t){this._fn=t,this._cleanup=void 0,this._sources=void 0,this._nextBatchedEffect=void 0,this._flags=N}P.prototype._callback=function(){let t=this._start();try{if(this._flags&R||this._fn===void 0)return;let e=this._fn();typeof e=="function"&&(this._cleanup=e)}finally{t()}};P.prototype._start=function(){if(this._flags&v)throw _(A,"SignalCycleDetected");this._flags|=v,this._flags&=~R,ye(this),me(this),Q();let t=c;return c=this,$e.bind(this,t)};P.prototype._notify=function(){this._flags&w||(this._flags|=w,this._nextBatchedEffect=D,D=this)};P.prototype._dispose=function(){this._flags|=R,this._flags&v||te(this)};function G(t){let e=new P(t);try{e._callback()}catch(n){throw e._dispose(),n}return e._dispose.bind(e)}var xe="namespacedSignals",C=t=>{document.dispatchEvent(new CustomEvent(ie,{detail:Object.assign({added:[],removed:[],updated:[]},t)}))};function Se(t,e=!1){let n={};for(let s in t)if(Object.hasOwn(t,s)){if(e&&s.startsWith("_"))continue;let r=t[s];r instanceof f?n[s]=r.value:n[s]=Se(r)}return n}function be(t,e,n=!1){let s={added:[],removed:[],updated:[]};for(let r in e)if(Object.hasOwn(e,r)){if(r.match(/\_\_+/))throw _(xe,"InvalidSignalKey",{key:r});let o=e[r];if(o instanceof Object&&!Array.isArray(o)){t[r]||(t[r]={});let a=be(t[r],o,n);s.added.push(...a.added.map(i=>`${r}.${i}`)),s.removed.push(...a.removed.map(i=>`${r}.${i}`)),s.updated.push(...a.updated.map(i=>`${r}.${i}`))}else{if(Object.hasOwn(t,r)){if(n)continue;let l=t[r];if(l instanceof f){let u=l.value;l.value=o,u!==o&&s.updated.push(r);continue}}let i=new f(o);i._onChange=()=>{C({updated:[r]})},t[r]=i,s.added.push(r)}}return s}function Te(t,e){for(let n in t)if(Object.hasOwn(t,n)){let s=t[n];s instanceof f?e(n,s):Te(s,(r,o)=>{e(`${n}.${r}`,o)})}}function Ie(t,...e){let n={};for(let s of e){let r=s.split("."),o=t,a=n;for(let l=0;l<r.length-1;l++){let u=r[l];if(!o[u])return{};a[u]||(a[u]={}),o=o[u],a=a[u]}let i=r[r.length-1];a[i]=o[i]}return n}var j=class{#e={};exists(e){return!!this.signal(e)}signal(e){let n=e.split("."),s=this.#e;for(let a=0;a<n.length-1;a++){let i=n[a];if(!s[i])return null;s=s[i]}let r=n[n.length-1],o=s[r];if(!o)throw _(xe,"SignalNotFound",{path:e});return o}setSignal(e,n){let s=e.split("."),r=this.#e;for(let a=0;a<s.length-1;a++){let i=s[a];r[i]||(r[i]={}),r=r[i]}let o=s[s.length-1];r[o]=n}setComputed(e,n){let s=ve(()=>n());this.setSignal(e,s)}value(e){return this.signal(e)?.value}setValue(e,n){let s=this.upsertIfMissing(e,n),r=s.value;s.value=n,r!==n&&C({updated:[e]})}upsertIfMissing(e,n){let s=e.split("."),r=this.#e;for(let l=0;l<s.length-1;l++){let u=s[l];r[u]||(r[u]={}),r=r[u]}let o=s[s.length-1],a=r[o];if(a instanceof f)return a;let i=new f(n);return i._onChange=()=>{C({updated:[e]})},r[o]=i,C({added:[e]}),i}remove(...e){if(!e.length){this.#e={};return}let n=Array();for(let s of e){let r=s.split("."),o=this.#e;for(let i=0;i<r.length-1;i++){let l=r[i];if(!o[l])return;o=o[l]}let a=r[r.length-1];delete o[a],n.push(s)}C({removed:n})}merge(e,n=!1){let s=be(this.#e,e,n);(s.added.length||s.removed.length||s.updated.length)&&C(s)}subset(...e){return Ie(this.values(),...e)}walk(e){Te(this.#e,e)}paths(){let e=new Array;return this.walk(n=>e.push(n)),e}values(e=!1){return Se(this.#e,e)}JSON(e=!0,n=!1){let s=this.values(n);return e?JSON.stringify(s,null,2):JSON.stringify(s)}toString(){return this.JSON()}};var Ee=(t,e)=>`${t}${O}${e}`,Ae=new j,se=[],K={},Fe=[],H="";function we(t){H=t}var ne=null,b=new Map;function B(...t){for(let e of t){let n={get signals(){return Ae},effect:r=>G(r),actions:K,plugin:e,apply:W},s;switch(e.type){case 2:{let r=e;Fe.push(r),s=r.onGlobalInit;break}case 3:{K[e.name]=e;break}case 1:{let r=e;se.push(r),s=r.onGlobalInit;break}default:throw pe("InvalidPluginType",n)}s&&s(n)}se.sort((e,n)=>{let s=n.name.length-e.name.length;return s!==0?s:e.name.localeCompare(n.name)}),Le()}var Le=de(()=>{W(document.body),Ge()},1);function W(t){Y(t,e=>{let n=b.get(e);if(n){for(let[,s]of n)s();b.delete(e)}for(let s of Object.keys(e.dataset))Ne(e,s)})}function Ge(){ne||(ne=new MutationObserver(t=>{for(let{target:e,type:n,attributeName:s,oldValue:r,addedNodes:o,removedNodes:a}of t)switch(n){case"childList":{for(let i of a){let l=i,u=b.get(l);if(u){for(let[g,m]of u)m();b.delete(l)}}for(let i of o)W(i)}break;case"attributes":{{let i="data-",l=i+(H?`${H}-`:"");if(!s?.startsWith(l))break;let u=e,g=M(s.slice(i.length));if(r!==null&&u.dataset[g]!==r){let m=b.get(u);if(m){let y=Ee(g,r),d=m.get(y);d&&(d(),m.delete(y))}}g in u.dataset&&Ne(u,g)}break}}}),ne.observe(document.body,{attributes:!0,attributeOldValue:!0,childList:!0,subtree:!0}))}function Ne(t,e){let n=e.slice(H.length),s=se.find(p=>n.startsWith(p.name));if(!s)return;let r=b.get(t);if(r)for(let[p,q]of r)p.startsWith(e)&&(q(),r.delete(p));t.id.length||(t.id=fe(t));let[o,...a]=n.slice(s.name.length).split(/\_\_+/),i=o.length>0;i&&(o=M(o));let l=t.dataset[e]||"",u=l.length>0,g={get signals(){return Ae},apply:W,effect:p=>G(p),actions:K,genRX:()=>je(g,...s.argNames||[]),plugin:s,el:t,rawKey:n,key:o,value:l,mods:new Map},m=s.keyReq||0;if(i){if(m===2)throw x(`${s.name}KeyNotAllowed`,g)}else if(m===1)throw x(`${s.name}KeyRequired`,g);let y=s.valReq||0;if(u){if(y===2)throw x(`${s.name}ValueNotAllowed`,g)}else if(y===1)throw x(`${s.name}ValueRequired`,g);if(m===3||y===3){if(i&&u)throw x(`${s.name}KeyAndValueProvided`,g);if(!i&&!u)throw x(`${s.name}KeyOrValueRequired`,g)}for(let p of a){let[q,...Re]=p.split(".");g.mods.set(M(q),new Set(Re.map(Ce=>Ce.toLowerCase())))}let d=s.onLoad(g);if(d){let p=b.get(t);p||(p=new Map,b.set(t,p)),p.set(Ee(e,l),d)}let h=s.removeOnLoad;h&&h(n)===!0&&delete t.dataset[e]}function je(t,...e){let n="",s=/(\/(\\\/|[^\/])*\/|"(\\"|[^\"])*"|'(\\'|[^'])*'|`(\\`|[^`])*`|[^;])+/gm,r=t.value.trim().match(s);if(r){let d=r.length-1,h=r[d].trim();h.startsWith("return")||(r[d]=`return (${h});`),n=r.join(`;
`)}let o=new Map,a=new RegExp(`(?:${O})(.*?)(?:${J})`,"gm");for(let d of n.matchAll(a)){let h=d[1],p=new k("dsEscaped").with(h).value;o.set(p,h),n=n.replace(O+h+J,p)}let i=/@(\w*)\(/gm,l=n.matchAll(i),u=new Set;for(let d of l)u.add(d[1]);let g=new RegExp(`@(${Object.keys(K).join("|")})\\(`,"gm");n=n.replaceAll(g,"ctx.actions.$1.fn(ctx,");let m=t.signals.paths();if(m.length){let d=new RegExp(`\\$(${m.join("|")})(\\W|$)`,"gm");n=n.replaceAll(d,"ctx.signals.signal('$1').value$2")}for(let[d,h]of o)n=n.replace(d,h);let y=`return (()=> {
${n}
})()`;t.fnContent=y;try{let d=new Function("ctx",...e,y);return(...h)=>{try{return d(t,...h)}catch(p){throw x("ExecuteExpression",t,{error:p.message})}}}catch(d){throw x("GenerateExpression",t,{error:d.message})}}B(ce,ue,le);export{B as load,we as setAliasPrefix};
//# sourceMappingURL=datastar-core.js.map
